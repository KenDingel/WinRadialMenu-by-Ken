<UserControl x:Class="RadialMenu.Controls.TreeMenuEditor"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:RadialMenu.Controls">
    <StackPanel Orientation="Vertical" HorizontalAlignment="Stretch" Margin="0,0,0,8">
        <!-- Modern Flat Toolbar -->
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch" Margin="0,0,0,12" Background="{StaticResource SurfaceBrush}">
            <Button Content="Add Item" Command="{Binding AddMenuItemCommand}" 
                    Style="{StaticResource ModernFlatButtonStyle}" Margin="0,0,8,0"/>
            <Button Content="Duplicate" Command="{Binding DuplicateMenuItemCommand}" 
                    Style="{StaticResource ModernFlatButtonStyle}" Margin="0,0,8,0"/>
            <Button Content="Delete" Command="{Binding DeleteMenuItemCommand}" 
                    Style="{StaticResource SecondaryButtonStyle}" Margin="0,0,8,0"/>
            <Rectangle Width="1" Fill="{StaticResource SurfaceDarkBrush}" Margin="8,4"/>
            <Button Content="Indent" Command="{Binding IndentCommand}" 
                    Style="{StaticResource SecondaryButtonStyle}" Margin="8,0,8,0"/>
            <Rectangle Width="1" Fill="{StaticResource SurfaceDarkBrush}" Margin="8,4"/>
            <TextBlock Text="Multi-Select:" VerticalAlignment="Center" Margin="8,0,8,0" 
                       FontFamily="{StaticResource PrimaryFontFamily}" FontWeight="Medium" 
                       Foreground="{StaticResource OnSurfaceSecondaryBrush}"/>
            <Button Content="Clear Selection" Click="ClearMultiSelection_Click" 
                    Style="{StaticResource SecondaryButtonStyle}" Margin="0,0,8,0"/>
        </StackPanel>

        <!-- Grid containing Tree View and Status -->
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Modern Flat Tree View -->
            <TreeView Grid.Row="0" 
                      x:Name="MenuTreeView"
                      ItemsSource="{Binding Working.Menu}"
                      SelectedItemChanged="TreeView_SelectedItemChanged"
                      AllowDrop="True"
                      PreviewMouseLeftButtonDown="TreeView_PreviewMouseLeftButtonDown"
                      PreviewMouseMove="TreeView_PreviewMouseMove"
                      Drop="TreeView_Drop"
                      PreviewMouseDoubleClick="TreeView_PreviewMouseDoubleClick"
                      MouseUp="TreeView_MouseUp"
                      Style="{StaticResource ModernTreeViewStyle}">
                <TreeView.ItemContainerStyle>
                    <Style TargetType="TreeViewItem" BasedOn="{StaticResource ModernTreeViewItemStyle}"/>
                </TreeView.ItemContainerStyle>
                <TreeView.ItemTemplate>
                    <HierarchicalDataTemplate ItemsSource="{Binding Submenu}">
                        <StackPanel Orientation="Horizontal" Margin="4">
                            <CheckBox x:Name="MultiSelectCheckBox" 
                                      Margin="0,0,8,0" 
                                      VerticalAlignment="Center"
                                      Checked="MultiSelectCheckBox_Checked"
                                      Unchecked="MultiSelectCheckBox_Unchecked"/>
                            <Border Background="{StaticResource PrimaryTransparentBrush}" 
                                    CornerRadius="3" Padding="4,2" Margin="0,0,4,0">
                                <TextBlock Text="{Binding Icon}" FontSize="14" 
                                           FontFamily="{StaticResource PrimaryFontFamily}"/>
                            </Border>
                            <TextBlock Text="{Binding Label}" 
                                       FontFamily="{StaticResource PrimaryFontFamily}" 
                                       FontWeight="Medium" 
                                       Foreground="{StaticResource OnSurfaceBrush}"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </HierarchicalDataTemplate>
                </TreeView.ItemTemplate>
            </TreeView>

            <!-- Modern Status -->
            <TextBlock Grid.Row="1" Text="{Binding MenuStatusText}" 
                       Margin="0,8,0,0" 
                       Foreground="{StaticResource OnSurfaceSecondaryBrush}"
                       FontFamily="{StaticResource PrimaryFontFamily}"
                       FontSize="12"
                       FontStyle="Italic"/>
        </Grid>
    </StackPanel>
</UserControl>

